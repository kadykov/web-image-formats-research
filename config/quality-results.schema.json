{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Quality Measurement Results",
  "description": "Schema for the output of quality measurements. Contains perceptual quality metrics (SSIMULACRA2, Butteraugli, PSNR, SSIM) for each encoded image measured against its original reference.",
  "type": "object",
  "required": ["study_id", "study_name", "dataset", "timestamp", "measurements"],
  "properties": {
    "study_id": {
      "type": "string",
      "description": "Identifier of the study these measurements belong to"
    },
    "study_name": {
      "type": "string",
      "description": "Human-readable name of the study"
    },
    "dataset": {
      "type": "object",
      "description": "Information about the source dataset used",
      "required": ["id", "path", "image_count"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Dataset identifier"
        },
        "path": {
          "type": "string",
          "description": "Path to the dataset directory (relative to project root)"
        },
        "image_count": {
          "type": "integer",
          "description": "Number of images used from the dataset",
          "minimum": 1
        }
      },
      "additionalProperties": false
    },
    "encoding_timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp from the encoding stage",
      "format": "date-time"
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp of when the quality measurements were completed",
      "format": "date-time"
    },
    "measurements": {
      "type": "array",
      "description": "List of all quality measurement records",
      "items": {
        "type": "object",
        "required": [
          "source_image",
          "original_image",
          "encoded_path",
          "format",
          "quality",
          "file_size"
        ],
        "properties": {
          "source_image": {
            "type": "string",
            "description": "Path to the source image used for encoding (relative to project root)"
          },
          "original_image": {
            "type": "string",
            "description": "Path to the original dataset image used as quality reference (relative to project root)"
          },
          "encoded_path": {
            "type": "string",
            "description": "Path to the encoded output file (relative to project root)"
          },
          "format": {
            "type": "string",
            "description": "Encoding format used",
            "enum": ["jpeg", "webp", "avif", "jxl"]
          },
          "quality": {
            "type": "integer",
            "description": "Quality setting used for encoding",
            "minimum": 0,
            "maximum": 100
          },
          "chroma_subsampling": {
            "type": "string",
            "description": "Chroma subsampling mode used, if applicable",
            "enum": ["444", "422", "420", "400"]
          },
          "speed": {
            "type": "integer",
            "description": "Speed setting for AVIF encoder (0-10, lower is slower/better), if applicable"
          },
          "effort": {
            "type": "integer",
            "description": "Effort setting for JPEG XL encoder (1-10, higher is slower/better), if applicable"
          },
          "method": {
            "type": "integer",
            "description": "Compression method for WebP encoder (0-6, higher is slower/better), if applicable"
          },
          "resolution": {
            "type": "integer",
            "description": "Target resolution (longest edge in pixels) if preprocessing was applied"
          },
          "width": {
            "type": "integer",
            "description": "Width of the encoded image in pixels",
            "minimum": 1
          },
          "height": {
            "type": "integer",
            "description": "Height of the encoded image in pixels",
            "minimum": 1
          },
          "source_file_size": {
            "type": "integer",
            "description": "File size of the source image in bytes",
            "minimum": 0
          },
          "file_size": {
            "type": "integer",
            "description": "File size of the encoded image in bytes",
            "minimum": 1
          },
          "ssimulacra2": {
            "type": ["number", "null"],
            "description": "SSIMULACRA2 score (higher is better, ~100 = lossless, <30 = poor, 70-90 = good, >90 = excellent)"
          },
          "psnr": {
            "type": ["number", "null"],
            "description": "Peak Signal-to-Noise Ratio in dB (higher is better, >40dB = excellent, 30-40dB = good)"
          },
          "ssim": {
            "type": ["number", "null"],
            "description": "Structural Similarity Index (0-1, higher is better, >0.95 = excellent)"
          },
          "butteraugli": {
            "type": ["number", "null"],
            "description": "Butteraugli perceptual distance (lower is better, <1.0 = excellent, <1.5 = good, >3.0 = poor)"
          },
          "measurement_error": {
            "type": ["string", "null"],
            "description": "Error message if any measurements failed"
          },
          "extra_args": {
            "type": "object",
            "description": "Any encoder-specific extra arguments that were used",
            "additionalProperties": {
              "type": ["string", "integer", "boolean"]
            }
          }
        },
        "additionalProperties": false
      }
    }
  },
  "additionalProperties": false
}
